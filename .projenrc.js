const { awscdk } = require('projen');
const { LernaProject } = require("lerna-projen");

const CDK_VERSION = '2.84.0';
const CDK_CONSTRUCTS_VERSION = '10.2.55';

const repository = 'git@github.com:awslabs/aws-data-solutions-framework.git';
const authorName = 'Amazon Web Services';
const authorAddress = 'https://aws.amazon.com';
const authorOrganization = true;
const license = 'MIT-0';
const copyrightOwner = 'Amazon.com, Inc. or its affiliates. All Rights Reserved.';
const copyrightPeriod = `2021-${new Date().getFullYear()}`;
const defaultReleaseBranch = 'main';
const release = false; /* to update and configure when ready to release */

const rootProject = new LernaProject({
  name: 'aws-data-solutions-framework',
  devDeps: ['lerna-projen'],

  defaultReleaseBranch,
  repository,
  authorName,
  authorAddress,
  authorOrganization,
  license,
  copyrightOwner,
  copyrightPeriod,
  release,

  pullRequestTemplate: false, // define it manually
  githubOptions: {
    workflows: false // define them manually (workflows generated by projen are not secured)
  },
  packageName: 'aws-data-solutions-framework',

  gitignore: [
      '.idea',
      'dist'
  ]
});

const framework = new awscdk.AwsCdkConstructLibrary({
  name: 'framework',
  description: 'L3 CDK Constructs used to build data solutions with AWS',

  parent: rootProject,
  outdir: 'framework',
  repositoryDirectory: 'framework',

  defaultReleaseBranch,

  repository,
  authorName,
  authorAddress,
  authorOrganization,
  license,
  copyrightOwner,
  copyrightPeriod,
  release,

  keywords: [
    'aws',
    'constructs',
    'cdk',
    'analytics',
    'database',
    'data'
  ],

  cdkVersion: CDK_VERSION,
  constructsVersion: CDK_CONSTRUCTS_VERSION,
  jsiiVersion: '~5.0.0',

  // publishToNuget: {
  //   dotNetNamespace: 'Acme.HelloNamespace',
  //   packageId: 'Acme.HelloPackage'
  // },
  // publishToMaven: {
  //   javaPackage: 'com.acme.hello',
  //   mavenArtifactId: 'hello-jsii',
  //   mavenGroupId: 'com.acme.hello'
  //   serverId: 'github',
  //   repositoryUrl: 'https://maven.pkg.github.com/example/hello-jsii',
  // },
  // publishToPypi: {
  //   distName: 'acme.hello-jsii',
  //   module: 'acme.hello_jsii'
  // },

  // deps: [],                /* Runtime dependencies of this module. */
  devDeps: [
    'jsii-rosetta@5.0.x',
    '@types/jest',
    'cdk-nag@^2.0.0',
    'jest-runner-groups',
  ],

  jestOptions: {
    jestConfig: {
      runner: 'groups',
    },
  },

});

rootProject.synth();